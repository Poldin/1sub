---
title: "API Reference"
description: "Complete reference for all 1Sub API endpoints"
---

# API Reference

Complete documentation for all 1Sub vendor API endpoints.

<Note>
All endpoints require Bearer authentication with your tool's API key unless otherwise specified.
</Note>


## Exchange Authorization Code

Exchange an authorization code for a verification token and user entitlements.

<ParamField header="Authorization" type="string" required>
Bearer token with your tool API key (format: `Bearer sk-tool-xxxxx`)
</ParamField>

<ParamField body="code" type="string" required>
The authorization code received from the callback redirect
</ParamField>

<ParamField body="redirectUri" type="string">
Optional redirect URI used in the authorization flow (must match registered callback)
</ParamField>

**Endpoint:** `POST /api/v1/authorize/exchange`

**Rate Limit:** 60 requests per minute

<RequestExample>
```bash cURL
curl -X POST 'https://1sub.io/api/v1/authorize/exchange' \
  -H 'Authorization: Bearer sk-tool-xxxxxxxxxxxxxxxxxxxxxxxx' \
  -H 'Content-Type: application/json' \
  -d '{
    "code": "ac_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
    "redirectUri": "https://yourapp.com/auth/1sub/callback"
  }'
```

```javascript Node.js
const response = await fetch('https://1sub.io/api/v1/authorize/exchange', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${process.env.ONESUB_API_KEY}`,
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    code: 'ac_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx',
    redirectUri: 'https://yourapp.com/auth/1sub/callback'
  })
});

const result = await response.json();
```

```python Python
import requests

response = requests.post(
    'https://1sub.io/api/v1/authorize/exchange',
    json={
        'code': 'ac_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx',
        'redirectUri': 'https://yourapp.com/auth/1sub/callback'
    },
    headers={
        'Authorization': f'Bearer {os.environ["ONESUB_API_KEY"]}',
        'Content-Type': 'application/json'
    }
)

result = response.json()
```
</RequestExample>

<ResponseExample>
```json 200 OK - Success
{
  "valid": true,
  "grantId": "grant_xxxxx",
  "onesubUserId": "550e8400-e29b-41d4-a716-446655440000",
  "entitlements": {
    "planId": "monthly",
    "creditsRemaining": 1200,
    "features": ["pro", "api_access"],
    "limits": {
      "api_calls_per_day": 10000
    }
  },
  "verificationToken": "vt_xxxxxxxxxxxxxxxxxxxxxxxx",
  "expiresAt": 1703000400
}
```

```json 400 Bad Request - Invalid Code
{
  "valid": false,
  "error": "INVALID_CODE",
  "message": "Authorization code is invalid or expired"
}
```

```json 401 Unauthorized
{
  "valid": false,
  "error": "UNAUTHORIZED",
  "message": "Invalid API key"
}
```

```json 403 Forbidden - Access Revoked
{
  "valid": false,
  "error": "ACCESS_REVOKED",
  "message": "User's access has been revoked"
}
```
</ResponseExample>

### Response Fields

<ResponseField name="valid" type="boolean" required>
Whether the authorization was successful
</ResponseField>

<ResponseField name="grantId" type="string" required>
Unique identifier for this authorization grant
</ResponseField>

<ResponseField name="onesubUserId" type="string (UUID)" required>
The 1Sub user ID. Store this for future API calls.
</ResponseField>

<ResponseField name="entitlements" type="object" required>
User's subscription details and entitlements
</ResponseField>

<ResponseField name="entitlements.planId" type="string | null">
Plan identifier (e.g., `"monthly"`, `"annual"`, `"pro"`)
</ResponseField>

<ResponseField name="entitlements.creditsRemaining" type="number | null">
Credits remaining if subscription includes credits
</ResponseField>

<ResponseField name="entitlements.features" type="string[]">
Array of enabled feature flags for this user
</ResponseField>

<ResponseField name="entitlements.limits" type="Record<string, number>">
Usage limits configured for this subscription
</ResponseField>

<ResponseField name="verificationToken" type="string" required>
Token for periodic verification. Store this securely in the user's session.
</ResponseField>

<ResponseField name="expiresAt" type="number" required>
Unix timestamp when the verification token expires (typically 24 hours)
</ResponseField>

<Warning>
Store the `verificationToken` securely. You'll need it for periodic verification calls.
</Warning>

---

## Verify Token

Verify a user's access token and get updated entitlements. Call this every 5 minutes to ensure access is still valid.

<ParamField header="Authorization" type="string" required>
Bearer token with your tool API key (format: `Bearer sk-tool-xxxxx`)
</ParamField>

<ParamField body="verificationToken" type="string" required>
The verification token from the exchange or previous verify call
</ParamField>

**Endpoint:** `POST /api/v1/verify`

**Rate Limit:** 120 requests per minute

<RequestExample>
```bash cURL
curl -X POST 'https://1sub.io/api/v1/verify' \
  -H 'Authorization: Bearer sk-tool-xxxxxxxxxxxxxxxxxxxxxxxx' \
  -H 'Content-Type: application/json' \
  -d '{
    "verificationToken": "vt_xxxxxxxxxxxxxxxxxxxxxxxx"
  }'
```

```javascript Node.js
const response = await fetch('https://1sub.io/api/v1/verify', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${process.env.ONESUB_API_KEY}`,
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    verificationToken: currentToken
  })
});

const result = await response.json();
```

```python Python
import requests

response = requests.post(
    'https://1sub.io/api/v1/verify',
    json={'verificationToken': current_token},
    headers={
        'Authorization': f'Bearer {os.environ["ONESUB_API_KEY"]}',
        'Content-Type': 'application/json'
    }
)

result = response.json()
```
</RequestExample>

<ResponseExample>
```json 200 OK - Valid Access
{
  "valid": true,
  "onesubUserId": "550e8400-e29b-41d4-a716-446655440000",
  "entitlements": {
    "planId": "monthly",
    "creditsRemaining": 1150,
    "features": ["pro", "api_access"],
    "limits": {
      "api_calls_per_day": 10000
    }
  },
  "verificationToken": "vt_NEW_xxxxxxxxxxxxxxxxxxxxxxxx",
  "cacheUntil": 1703000700,
  "nextVerificationBefore": 1703001000
}
```

```json 403 Forbidden - Access Revoked
{
  "valid": false,
  "error": "ACCESS_REVOKED",
  "reason": "Subscription canceled",
  "action": "terminate_session"
}
```

```json 401 Unauthorized - Token Expired
{
  "valid": false,
  "error": "TOKEN_EXPIRED",
  "reason": "Verification token has expired",
  "action": "reauthenticate"
}
```
</ResponseExample>

### Response Fields

<ResponseField name="valid" type="boolean" required>
Whether the user's access is still valid
</ResponseField>

<ResponseField name="onesubUserId" type="string (UUID)">
The 1Sub user ID (only present when `valid: true`)
</ResponseField>

<ResponseField name="entitlements" type="object">
Updated user entitlements (only present when `valid: true`)
</ResponseField>

<ResponseField name="verificationToken" type="string">
NEW verification token for the next call. Always update your stored token! (only present when `valid: true`)
</ResponseField>

<ResponseField name="cacheUntil" type="number">
Unix timestamp - you can cache entitlements until this time (only present when `valid: true`)
</ResponseField>

<ResponseField name="nextVerificationBefore" type="number">
Unix timestamp - verify again before this time (only present when `valid: true`)
</ResponseField>

<ResponseField name="error" type="string">
Error code (only present when `valid: false`)
</ResponseField>

<ResponseField name="reason" type="string">
Human-readable reason for failure (only present when `valid: false`)
</ResponseField>

<ResponseField name="action" type="string">
Recommended action: `terminate_session` or `reauthenticate` (only present when `valid: false`)
</ResponseField>

<Warning>
**Critical:** The `verificationToken` changes on every successful verify call (token rolling). Always store the new token for subsequent requests!
</Warning>

---

## Consume Credits

Deduct credits from a user's balance for tool usage.

<ParamField header="Authorization" type="string" required>
Bearer token with your tool API key
</ParamField>

<ParamField body="user_id" type="string (UUID)" required>
The 1Sub user ID whose credits to consume
</ParamField>

<ParamField body="amount" type="number" required>
Number of credits to consume (positive integer, max 1,000,000)
</ParamField>

<ParamField body="reason" type="string" required>
Description of what credits were used for (1-500 characters)
</ParamField>

<ParamField body="idempotency_key" type="string" required>
Unique key to prevent duplicate charges (persisted for 24 hours)
</ParamField>

**Endpoint:** `POST /api/v1/credits/consume`

**Rate Limit:** 100 requests per minute

<RequestExample>
```bash cURL
curl -X POST 'https://1sub.io/api/v1/credits/consume' \
  -H 'Authorization: Bearer sk-tool-xxxxxxxxxxxxxxxxxxxxxxxx' \
  -H 'Content-Type: application/json' \
  -d '{
    "user_id": "550e8400-e29b-41d4-a716-446655440000",
    "amount": 10,
    "reason": "Generated 1 AI image (1024x1024)",
    "idempotency_key": "img-gen-user123-1702345678"
  }'
```

```javascript Node.js
const response = await fetch('https://1sub.io/api/v1/credits/consume', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${process.env.ONESUB_API_KEY}`,
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    user_id: oneSubUserId,
    amount: 10,
    reason: 'Generated 1 AI image',
    idempotency_key: `img-gen-${userId}-${Date.now()}`
  })
});

const result = await response.json();
console.log(`New balance: ${result.new_balance}`);
```

```python Python
import time

response = requests.post(
    'https://1sub.io/api/v1/credits/consume',
    json={
        'user_id': onesub_user_id,
        'amount': 10,
        'reason': 'Generated 1 AI image',
        'idempotency_key': f'img-gen-{user_id}-{int(time.time())}'
    },
    headers={
        'Authorization': f'Bearer {os.environ["ONESUB_API_KEY"]}',
        'Content-Type': 'application/json'
    }
)

result = response.json()
print(f"New balance: {result['new_balance']}")
```
</RequestExample>

<ResponseExample>
```json 200 OK - Success
{
  "success": true,
  "new_balance": 90,
  "transaction_id": "txn-abc123def456"
}
```

```json 400 Bad Request - Insufficient Credits
{
  "error": "Insufficient credits",
  "message": "User does not have sufficient credits",
  "current_balance": 5,
  "required": 10,
  "shortfall": 5
}
```

```json 401 Unauthorized
{
  "error": "Invalid API key",
  "message": "The provided API key is invalid or does not exist"
}
```

```json 409 Conflict - Duplicate Request
{
  "success": true,
  "new_balance": 90,
  "transaction_id": "txn-abc123def456",
  "is_duplicate": true,
  "message": "This request has already been processed"
}
```

```json 200 OK - Idempotent Request
{
  "success": true,
  "message": "Idempotent request already processed",
  "transaction_id": "txn-abc123def456",
  "new_balance": 90
}
```
</ResponseExample>

### Response Fields

<ResponseField name="success" type="boolean" required>
Whether credits were successfully consumed
</ResponseField>

<ResponseField name="new_balance" type="number" required>
User's credit balance after consumption
</ResponseField>

<ResponseField name="transaction_id" type="string" required>
Unique ID for this transaction
</ResponseField>

<Tip>
Store the `transaction_id` for auditing and support purposes.
</Tip>

---

## Error Handling

All endpoints return standard error responses:

```json
{
  "error": "Error type",
  "message": "Human-readable message",
  "details": {}
}
```

### Common Error Codes

| Status | Error | Meaning | Action |
|--------|-------|---------|--------|
| 400 | Bad Request | Invalid parameters or insufficient credits | Check request body |
| 401 | Unauthorized | Invalid/missing API key | Verify API key |
| 403 | Forbidden | Valid auth but no permission | Check tool/user access |
| 404 | Not Found | Resource doesn't exist | Verify user/subscription exists |
| 409 | Conflict | Duplicate/conflicting request | Check idempotency key or existing links |
| 422 | Unprocessable Entity | Validation failed | Fix validation errors |
| 429 | Rate Limit Exceeded | Too many requests | Implement backoff, respect `Retry-After` |
| 500 | Internal Server Error | Server error | Retry with exponential backoff |

<Warning>
Always implement proper error handling and retry logic, especially for 429 and 500 errors.
</Warning>

## Rate Limit Headers

All authenticated endpoints return rate limit information:

```http
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 2025-12-01T12:35:00Z
```

Use these headers to track your usage and avoid hitting rate limits.

