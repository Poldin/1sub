---
title: "Webhook Events"
description: "Complete reference for all webhook event types and their payloads"
---

# Webhook Events

Detailed reference for all webhook events sent by 1Sub.

## Available Events

1Sub sends webhooks for the following events:

- **`subscription.activated`** - New subscription created or reactivated
- **`subscription.updated`** - Subscription details changed (renewal, plan change, etc.)
- **`subscription.canceled`** - Subscription canceled or expired
- **`purchase.completed`** - One-time purchase completed
- **`user.credit_low`** - User's credit balance is running low
- **`user.credit_depleted`** - User's credit balance reached zero
- **`tool.status_changed`** - Your tool's status changed on 1Sub platform
- **`entitlement.granted`** - User granted access via authorization flow
- **`entitlement.revoked`** - User's access revoked
- **`entitlement.changed`** - User's plan or features changed
- **`verify.required`** - Immediate verification required (security event)
- **`credits.consumed`** - Credits consumed by a user

## Event Structure

All webhook events follow this structure:

```json
{
  "id": "evt_abc123def456",
  "type": "subscription.activated",
  "created": 1700000000,
  "data": {
    // Event-specific data
  }
}
```

## subscription.activated

Sent when a new subscription is created or a canceled subscription is reactivated.

### When Sent

- User completes initial subscription payment
- User reactivates a previously canceled subscription
- Free trial begins
- Subscription moves from `incomplete` to `active` or `trialing`

### Payload

<ResponseField name="id" type="string" required>
Unique event ID (format: `evt_xxxxx`)
</ResponseField>

<ResponseField name="type" type="string" required>
Always `"subscription.activated"`
</ResponseField>

<ResponseField name="created" type="number" required>
Unix timestamp when event was created
</ResponseField>

<ResponseField name="data" type="object" required>
Event data

<Expandable title="Data Fields">
  <ResponseField name="oneSubUserId" type="string (UUID)" required>
  The 1Sub user ID
  </ResponseField>
  
  <ResponseField name="userEmail" type="string">
  The user's email address
  </ResponseField>
  
  <ResponseField name="planId" type="string" required>
  Plan identifier (e.g., `"monthly"`, `"annual"`, `"pro"`)
  </ResponseField>
  
  <ResponseField name="productId" type="string (UUID)" required>
  Your tool's product ID
  </ResponseField>
  
  <ResponseField name="status" type="string" required>
  Subscription status: `"active"` or `"trialing"`
  </ResponseField>
  
  <ResponseField name="currentPeriodStart" type="string (ISO 8601)" required>
  Start of current billing period
  </ResponseField>
  
  <ResponseField name="currentPeriodEnd" type="string (ISO 8601)" required>
  End of current billing period (renewal date)
  </ResponseField>
  
  <ResponseField name="quantity" type="number">
  Subscription quantity (usually 1)
  </ResponseField>
  
  <ResponseField name="creditsRemaining" type="number">
  Credits remaining if subscription includes credits
  </ResponseField>
  
  <ResponseField name="trialEndsAt" type="string (ISO 8601) | null">
  When trial ends, if applicable
  </ResponseField>
</Expandable>
</ResponseField>

### Example Payload

<CodeGroup>
```json New Paid Subscription
{
  "id": "evt_sub_activated_001",
  "type": "subscription.activated",
  "created": 1700000000,
  "data": {
    "oneSubUserId": "550e8400-e29b-41d4-a716-446655440000",
    "userEmail": "user@example.com",
    "planId": "monthly",
    "productId": "660e8400-e29b-41d4-a716-446655440000",
    "status": "active",
    "currentPeriodStart": "2025-11-01T00:00:00Z",
    "currentPeriodEnd": "2025-12-01T00:00:00Z",
    "quantity": 1,
    "creditsRemaining": 1000,
    "trialEndsAt": null
  }
}
```

```json Free Trial Started
{
  "id": "evt_sub_activated_002",
  "type": "subscription.activated",
  "created": 1700000000,
  "data": {
    "oneSubUserId": "550e8400-e29b-41d4-a716-446655440000",
    "userEmail": "user@example.com",
    "planId": "pro",
    "productId": "660e8400-e29b-41d4-a716-446655440000",
    "status": "trialing",
    "currentPeriodStart": "2025-11-01T00:00:00Z",
    "currentPeriodEnd": "2025-12-01T00:00:00Z",
    "quantity": 1,
    "trialEndsAt": "2025-11-08T00:00:00Z"
  }
}
```
</CodeGroup>

### How to Handle

```typescript
case 'subscription.activated':
  const { oneSubUserId, userEmail, planId, status } = event.data;
  
  // Grant user access
  await grantUserAccess(oneSubUserId, planId);
  
  // Send welcome email
  if (status === 'trialing') {
    await sendTrialStartedEmail(userEmail);
  } else {
    await sendWelcomeEmail(userEmail);
  }
  
  // Clear subscription cache
  subscriptionCache.delete(oneSubUserId);
  
  // Log event
  logger.info('Subscription activated', {
    userId: oneSubUserId,
    email: userEmail,
    plan: planId,
    status
  });
  break;
```

---

## subscription.updated

Sent when subscription details change.

### When Sent

- User upgrades or downgrades plan
- Billing period renews
- Trial ends and converts to paid
- Payment method updated
- Subscription quantity changes

### Payload

<ResponseField name="id" type="string" required>
Unique event ID
</ResponseField>

<ResponseField name="type" type="string" required>
Always `"subscription.updated"`
</ResponseField>

<ResponseField name="created" type="number" required>
Unix timestamp
</ResponseField>

<ResponseField name="data" type="object" required>
Event data

<Expandable title="Data Fields">
  <ResponseField name="oneSubUserId" type="string (UUID)" required>
  The 1Sub user ID
  </ResponseField>
  
  <ResponseField name="userEmail" type="string">
  The user's email address
  </ResponseField>
  
  <ResponseField name="planId" type="string" required>
  Current plan ID
  </ResponseField>
  
  <ResponseField name="previousPlanId" type="string">
  Previous plan ID (for plan changes)
  </ResponseField>
  
  <ResponseField name="status" type="string" required>
  Current subscription status
  </ResponseField>
  
  <ResponseField name="previousStatus" type="string">
  Previous subscription status
  </ResponseField>
  
  <ResponseField name="currentPeriodStart" type="string (ISO 8601)" required>
  Start of current billing period
  </ResponseField>
  
  <ResponseField name="currentPeriodEnd" type="string (ISO 8601)" required>
  End of current billing period
  </ResponseField>
  
  <ResponseField name="quantity" type="number">
  Current quantity
  </ResponseField>
  
  <ResponseField name="previousQuantity" type="number">
  Previous quantity (for quantity changes)
  </ResponseField>
</Expandable>
</ResponseField>

### Example Payload

<CodeGroup>
```json Plan Upgrade
{
  "id": "evt_sub_updated_001",
  "type": "subscription.updated",
  "created": 1700000000,
  "data": {
    "oneSubUserId": "550e8400-e29b-41d4-a716-446655440000",
    "userEmail": "user@example.com",
    "planId": "enterprise",
    "previousPlanId": "pro",
    "productId": "660e8400-e29b-41d4-a716-446655440000",
    "status": "active",
    "previousStatus": "active",
    "currentPeriodStart": "2025-11-01T00:00:00Z",
    "currentPeriodEnd": "2025-12-01T00:00:00Z",
    "quantity": 1
  }
}
```

```json Trial Converted
{
  "id": "evt_sub_updated_002",
  "type": "subscription.updated",
  "created": 1700000000,
  "data": {
    "oneSubUserId": "550e8400-e29b-41d4-a716-446655440000",
    "userEmail": "user@example.com",
    "planId": "pro",
    "productId": "660e8400-e29b-41d4-a716-446655440000",
    "status": "active",
    "previousStatus": "trialing",
    "currentPeriodStart": "2025-11-08T00:00:00Z",
    "currentPeriodEnd": "2025-12-08T00:00:00Z",
    "quantity": 1
  }
}
```

```json Billing Period Renewed
{
  "id": "evt_sub_updated_003",
  "type": "subscription.updated",
  "created": 1700000000,
  "data": {
    "oneSubUserId": "550e8400-e29b-41d4-a716-446655440000",
    "userEmail": "user@example.com",
    "planId": "monthly",
    "productId": "660e8400-e29b-41d4-a716-446655440000",
    "status": "active",
    "currentPeriodStart": "2025-12-01T00:00:00Z",
    "currentPeriodEnd": "2026-01-01T00:00:00Z",
    "quantity": 1,
    "creditsRemaining": 1000
  }
}
```
</CodeGroup>

### How to Handle

```typescript
case 'subscription.updated':
  const { oneSubUserId, userEmail, planId, previousPlanId, status, previousStatus } = event.data;
  
  // Handle plan changes
  if (previousPlanId && previousPlanId !== planId) {
    await updateUserPlan(oneSubUserId, planId, previousPlanId);
    await sendPlanChangeEmail(userEmail, planId, previousPlanId);
  }
  
  // Handle status changes
  if (previousStatus === 'trialing' && status === 'active') {
    await sendTrialConvertedEmail(userEmail);
  }
  
  // Handle renewals (period changed but same plan)
  if (!previousPlanId && status === 'active') {
    await logRenewal(oneSubUserId);
  }
  
  // Clear subscription cache
  subscriptionCache.delete(oneSubUserId);
  break;
```

---

## subscription.canceled

Sent when a subscription is canceled or expires.

### When Sent

- User cancels subscription
- Payment fails after all retry attempts
- Trial expires without payment
- Subscription reaches `cancelAtPeriodEnd` date

### Payload

<ResponseField name="id" type="string" required>
Unique event ID
</ResponseField>

<ResponseField name="type" type="string" required>
Always `"subscription.canceled"`
</ResponseField>

<ResponseField name="created" type="number" required>
Unix timestamp
</ResponseField>

<ResponseField name="data" type="object" required>
Event data

<Expandable title="Data Fields">
  <ResponseField name="oneSubUserId" type="string (UUID)" required>
  The 1Sub user ID
  </ResponseField>
  
  <ResponseField name="userEmail" type="string">
  The user's email address
  </ResponseField>
  
  <ResponseField name="planId" type="string" required>
  Plan that was canceled
  </ResponseField>
  
  <ResponseField name="productId" type="string (UUID)" required>
  Your tool's product ID
  </ResponseField>
  
  <ResponseField name="status" type="string" required>
  Always `"canceled"`
  </ResponseField>
  
  <ResponseField name="cancellationReason" type="string">
  Reason for cancellation: `"user_requested"`, `"payment_failed"`, `"trial_expired"`
  </ResponseField>
  
  <ResponseField name="effectiveDate" type="string (ISO 8601)" required>
  When cancellation becomes effective (may be in future if `cancelAtPeriodEnd`)
  </ResponseField>
  
  <ResponseField name="canceledAt" type="string (ISO 8601)" required>
  When cancellation was initiated
  </ResponseField>
</Expandable>
</ResponseField>

### Example Payload

<CodeGroup>
```json User Canceled
{
  "id": "evt_sub_canceled_001",
  "type": "subscription.canceled",
  "created": 1700000000,
  "data": {
    "oneSubUserId": "550e8400-e29b-41d4-a716-446655440000",
    "userEmail": "user@example.com",
    "planId": "pro",
    "productId": "660e8400-e29b-41d4-a716-446655440000",
    "status": "canceled",
    "cancellationReason": "user_requested",
    "effectiveDate": "2025-12-01T00:00:00Z",
    "canceledAt": "2025-11-15T10:30:00Z"
  }
}
```

```json Payment Failed
{
  "id": "evt_sub_canceled_002",
  "type": "subscription.canceled",
  "created": 1700000000,
  "data": {
    "oneSubUserId": "550e8400-e29b-41d4-a716-446655440000",
    "userEmail": "user@example.com",
    "planId": "monthly",
    "productId": "660e8400-e29b-41d4-a716-446655440000",
    "status": "canceled",
    "cancellationReason": "payment_failed",
    "effectiveDate": "2025-11-20T00:00:00Z",
    "canceledAt": "2025-11-20T00:00:00Z"
  }
}
```
</CodeGroup>

### How to Handle

```typescript
case 'subscription.canceled':
  const { oneSubUserId, userEmail, planId, cancellationReason, effectiveDate } = event.data;
  
  // Check if effective immediately or at period end
  const now = new Date();
  const effective = new Date(effectiveDate);
  
  if (effective <= now) {
    // Revoke access immediately
    await revokeUserAccess(oneSubUserId);
  } else {
    // Schedule revocation for later
    await scheduleAccessRevocation(oneSubUserId, effective);
  }
  
  // Send appropriate email
  if (cancellationReason === 'user_requested') {
    await sendCancellationConfirmationEmail(userEmail, effective);
  } else if (cancellationReason === 'payment_failed') {
    await sendPaymentFailedEmail(userEmail);
  }
  
  // Clear subscription cache
  subscriptionCache.delete(oneSubUserId);
  
  // Log for analytics
  await trackCancellation(oneSubUserId, planId, cancellationReason);
  break;
```

---

---

## purchase.completed

Sent when a user completes a one-time purchase of your tool or credit package.

### When Sent

- User completes a one-time tool purchase
- User buys credits for your tool
- Payment is confirmed for non-subscription purchases

### Payload

<ResponseField name="id" type="string" required>
Unique event ID
</ResponseField>

<ResponseField name="type" type="string" required>
Always `"purchase.completed"`
</ResponseField>

<ResponseField name="created" type="number" required>
Unix timestamp
</ResponseField>

<ResponseField name="data" type="object" required>
Event data

<Expandable title="Data Fields">
  <ResponseField name="oneSubUserId" type="string (UUID)" required>
  The 1Sub user ID
  </ResponseField>
  
  <ResponseField name="userEmail" type="string">
  The user's email address
  </ResponseField>
  
  <ResponseField name="checkoutId" type="string (UUID)" required>
  Checkout session ID for this purchase
  </ResponseField>
  
  <ResponseField name="amount" type="number" required>
  Purchase amount (in credits or currency units)
  </ResponseField>
  
  <ResponseField name="creditsRemaining" type="number">
  User's remaining credit balance after purchase
  </ResponseField>
  
  <ResponseField name="purchaseType" type="string">
  Type of purchase: `"tool_access"`, `"credits"`, `"one_time"`
  </ResponseField>
</Expandable>
</ResponseField>

### Example Payload

```json
{
  "id": "evt_purchase_001",
  "type": "purchase.completed",
  "created": 1700000000,
  "data": {
    "oneSubUserId": "550e8400-e29b-41d4-a716-446655440000",
    "userEmail": "user@example.com",
    "checkoutId": "chk_abc123def456",
    "amount": 100,
    "creditsRemaining": 150,
    "purchaseType": "credits"
  }
}
```

### How to Handle

```typescript
case 'purchase.completed':
  const { oneSubUserId, userEmail, checkoutId, amount, purchaseType } = event.data;
  
  // Log purchase
  await logPurchase(oneSubUserId, checkoutId, amount, purchaseType);
  
  // Grant one-time access if applicable
  if (purchaseType === 'tool_access') {
    await grantToolAccess(oneSubUserId);
  }
  
  // Send purchase confirmation email
  await sendPurchaseConfirmation(userEmail, amount);
  
  break;
```

---

## user.credit_low

Sent when a user's credit balance falls below the low credit threshold.

### When Sent

- User's credit balance drops to 10 or fewer credits
- Triggered during credit consumption
- Only sent once when crossing the threshold (not on every transaction)

### Payload

<ResponseField name="id" type="string" required>
Unique event ID
</ResponseField>

<ResponseField name="type" type="string" required>
Always `"user.credit_low"`
</ResponseField>

<ResponseField name="created" type="number" required>
Unix timestamp
</ResponseField>

<ResponseField name="data" type="object" required>
Event data

<Expandable title="Data Fields">
  <ResponseField name="oneSubUserId" type="string (UUID)" required>
  The 1Sub user ID
  </ResponseField>
  
  <ResponseField name="userEmail" type="string">
  The user's email address
  </ResponseField>
  
  <ResponseField name="creditBalance" type="number" required>
  User's current credit balance
  </ResponseField>
  
  <ResponseField name="threshold" type="number" required>
  The low credit threshold that was crossed (typically 10)
  </ResponseField>
</Expandable>
</ResponseField>

### Example Payload

```json
{
  "id": "evt_credit_low_001",
  "type": "user.credit_low",
  "created": 1700000000,
  "data": {
    "oneSubUserId": "550e8400-e29b-41d4-a716-446655440000",
    "userEmail": "user@example.com",
    "creditBalance": 8,
    "threshold": 10
  }
}
```

### How to Handle

```typescript
case 'user.credit_low':
  const { oneSubUserId, userEmail, creditBalance, threshold } = event.data;
  
  // Send low credit warning email
  await sendLowCreditWarning(userEmail, creditBalance);
  
  // Show in-app notification on next login
  await queueNotification(oneSubUserId, {
    type: 'credit_low',
    message: `Your credit balance is low (${creditBalance} remaining). Purchase more credits to continue using ${toolName}.`,
  });
  
  // Log for analytics
  await trackEvent('credit_low_warning', { userId: oneSubUserId, email: userEmail, balance: creditBalance });
  
  break;
```

---

## user.credit_depleted

Sent when a user's credit balance reaches zero.

### When Sent

- User's credit balance hits exactly 0
- Triggered during credit consumption
- Indicates user can no longer use credit-based features

### Payload

<ResponseField name="id" type="string" required>
Unique event ID
</ResponseField>

<ResponseField name="type" type="string" required>
Always `"user.credit_depleted"`
</ResponseField>

<ResponseField name="created" type="number" required>
Unix timestamp
</ResponseField>

<ResponseField name="data" type="object" required>
Event data

<Expandable title="Data Fields">
  <ResponseField name="oneSubUserId" type="string (UUID)" required>
  The 1Sub user ID
  </ResponseField>
  
  <ResponseField name="userEmail" type="string">
  The user's email address
  </ResponseField>
  
  <ResponseField name="creditBalance" type="number" required>
  Always 0
  </ResponseField>
</Expandable>
</ResponseField>

### Example Payload

```json
{
  "id": "evt_credit_depleted_001",
  "type": "user.credit_depleted",
  "created": 1700000000,
  "data": {
    "oneSubUserId": "550e8400-e29b-41d4-a716-446655440000",
    "userEmail": "user@example.com",
    "creditBalance": 0
  }
}
```

### How to Handle

```typescript
case 'user.credit_depleted':
  const { oneSubUserId, userEmail } = event.data;
  
  // Suspend credit-based features
  await suspendCreditFeatures(oneSubUserId);
  
  // Send urgent notification
  await sendCreditDepletedEmail(userEmail);
  
  // Show paywall on next request
  await setUserFlag(oneSubUserId, 'show_credit_paywall', true);
  
  // Log for analytics
  await trackEvent('credits_depleted', { userId: oneSubUserId, email: userEmail });
  
  break;
```

---

## tool.status_changed

Sent when your tool's status changes on the 1Sub platform (activated, suspended, etc.).

### When Sent

- Tool is activated by 1Sub admin
- Tool is suspended or deactivated
- Tool undergoes maintenance mode changes

<Warning>
This is a system-level event. The `oneSubUserId` field will be `"system"` instead of an actual user ID.
</Warning>

### Payload

<ResponseField name="id" type="string" required>
Unique event ID
</ResponseField>

<ResponseField name="type" type="string" required>
Always `"tool.status_changed"`
</ResponseField>

<ResponseField name="created" type="number" required>
Unix timestamp
</ResponseField>

<ResponseField name="data" type="object" required>
Event data

<Expandable title="Data Fields">
  <ResponseField name="oneSubUserId" type="string" required>
  Always `"system"` (this is a system event, not user-specific)
  </ResponseField>
  
  <ResponseField name="toolId" type="string (UUID)" required>
  Your tool's ID
  </ResponseField>
  
  <ResponseField name="toolStatus" type="boolean" required>
  `true` if tool is active, `false` if suspended/inactive
  </ResponseField>
</Expandable>
</ResponseField>

### Example Payload

```json
{
  "id": "evt_tool_status_001",
  "type": "tool.status_changed",
  "created": 1700000000,
  "data": {
    "oneSubUserId": "system",
    "toolId": "660e8400-e29b-41d4-a716-446655440000",
    "toolStatus": false
  }
}
```

### How to Handle

```typescript
case 'tool.status_changed':
  const { toolId, toolStatus } = event.data;
  
  if (!toolStatus) {
    // Tool suspended - enter maintenance mode
    await enableMaintenanceMode();
    
    // Notify all active users
    await notifyAllUsers({
      type: 'maintenance',
      message: 'Service temporarily unavailable. We\'ll be back shortly.',
    });
    
    // Alert ops team
    await alertOps(`Tool ${toolId} suspended on 1Sub`);
  } else {
    // Tool reactivated
    await disableMaintenanceMode();
    await notifyAllUsers({
      type: 'info',
      message: 'Service is back online!',
    });
  }
  
  break;
```

---

## entitlement.granted

Sent when a user is granted access to your tool via authorization code exchange.

### When Sent

- User completes OAuth-style authorization flow
- Authorization code is successfully exchanged for access token
- User's entitlement is activated
- This is the primary event for OAuth/authorization-based integrations

### Payload

<ResponseField name="id" type="string" required>
Unique event ID
</ResponseField>

<ResponseField name="type" type="string" required>
Always `"entitlement.granted"`
</ResponseField>

<ResponseField name="created" type="number" required>
Unix timestamp
</ResponseField>

<ResponseField name="data" type="object" required>
Event data

<Expandable title="Data Fields">
  <ResponseField name="oneSubUserId" type="string (UUID)" required>
  The 1Sub user ID
  </ResponseField>

  <ResponseField name="userEmail" type="string">
  The user's email address
  </ResponseField>

  <ResponseField name="grantId" type="string (UUID)" required>
  Unique identifier for this entitlement grant
  </ResponseField>

  <ResponseField name="planId" type="string" required>
  Plan identifier associated with this entitlement
  </ResponseField>

  <ResponseField name="status" type="string" required>
  Always `"active"` for granted entitlements
  </ResponseField>

  <ResponseField name="creditsRemaining" type="number">
  User's remaining credit balance if applicable
  </ResponseField>
</Expandable>
</ResponseField>

### Example Payload

```json
{
  "id": "evt_entitlement_granted_001",
  "type": "entitlement.granted",
  "created": 1700000000,
  "data": {
    "oneSubUserId": "550e8400-e29b-41d4-a716-446655440000",
    "userEmail": "user@example.com",
    "grantId": "grant_abc123def456",
    "planId": "pro",
    "status": "active",
    "creditsRemaining": 1000
  }
}
```

### How to Handle

```typescript
case 'entitlement.granted':
  const { oneSubUserId, userEmail, grantId, planId } = event.data;

  // Create or activate user account
  await createUserAccount(oneSubUserId, userEmail, planId);

  // Grant access to your tool
  await grantToolAccess(oneSubUserId, planId);

  // Send welcome email
  await sendWelcomeEmail(userEmail, planId);

  // Log entitlement grant
  logger.info('Entitlement granted', {
    userId: oneSubUserId,
    email: userEmail,
    grantId,
    plan: planId
  });

  break;
```

---

## entitlement.revoked

Sent when a user's access to your tool is revoked.

### When Sent

- Subscription expires or is canceled
- User manually revokes access
- Admin revokes access (fraud, TOS violation, etc.)
- Payment failure after grace period

### Payload

<ResponseField name="id" type="string" required>
Unique event ID
</ResponseField>

<ResponseField name="type" type="string" required>
Always `"entitlement.revoked"`
</ResponseField>

<ResponseField name="created" type="number" required>
Unix timestamp
</ResponseField>

<ResponseField name="data" type="object" required>
Event data

<Expandable title="Data Fields">
  <ResponseField name="oneSubUserId" type="string (UUID)" required>
  The 1Sub user ID
  </ResponseField>

  <ResponseField name="userEmail" type="string">
  The user's email address
  </ResponseField>

  <ResponseField name="reason" type="string" required>
  Reason for revocation: `"subscription_ended"`, `"user_requested"`, `"payment_failed"`, `"admin_action"`, `"fraud"`
  </ResponseField>

  <ResponseField name="revokedAt" type="string (ISO 8601)" required>
  When the entitlement was revoked
  </ResponseField>

  <ResponseField name="status" type="string" required>
  Always `"canceled"`
  </ResponseField>
</Expandable>
</ResponseField>

### Example Payload

```json
{
  "id": "evt_entitlement_revoked_001",
  "type": "entitlement.revoked",
  "created": 1700000000,
  "data": {
    "oneSubUserId": "550e8400-e29b-41d4-a716-446655440000",
    "userEmail": "user@example.com",
    "reason": "subscription_ended",
    "revokedAt": "2025-12-01T00:00:00Z",
    "status": "canceled"
  }
}
```

### How to Handle

```typescript
case 'entitlement.revoked':
  const { oneSubUserId, userEmail, reason, revokedAt } = event.data;

  // Immediately revoke user access
  await revokeUserAccess(oneSubUserId);

  // Handle based on revocation reason
  switch (reason) {
    case 'subscription_ended':
      await sendSubscriptionEndedEmail(userEmail);
      break;
    case 'payment_failed':
      await sendPaymentFailedEmail(userEmail);
      break;
    case 'fraud':
      await flagAccountForReview(oneSubUserId);
      break;
  }

  // Clear any cached user data
  await clearUserCache(oneSubUserId);

  // Log revocation
  logger.info('Entitlement revoked', {
    userId: oneSubUserId,
    email: userEmail,
    reason,
    revokedAt
  });

  break;
```

---

## entitlement.changed

Sent when a user's entitlement changes (plan upgrade, downgrade, or feature modifications).

### When Sent

- User upgrades or downgrades their plan
- Plan features are modified
- Access level changes
- Subscription tier transitions

### Payload

<ResponseField name="id" type="string" required>
Unique event ID
</ResponseField>

<ResponseField name="type" type="string" required>
Always `"entitlement.changed"`
</ResponseField>

<ResponseField name="created" type="number" required>
Unix timestamp
</ResponseField>

<ResponseField name="data" type="object" required>
Event data

<Expandable title="Data Fields">
  <ResponseField name="oneSubUserId" type="string (UUID)" required>
  The 1Sub user ID
  </ResponseField>

  <ResponseField name="userEmail" type="string">
  The user's email address
  </ResponseField>

  <ResponseField name="previousState" type="object" required>
  Previous entitlement state

  <Expandable title="Previous State Fields">
    <ResponseField name="planId" type="string">
    Previous plan ID
    </ResponseField>

    <ResponseField name="features" type="array">
    Previous feature list
    </ResponseField>
  </Expandable>
  </ResponseField>

  <ResponseField name="newState" type="object" required>
  New entitlement state

  <Expandable title="New State Fields">
    <ResponseField name="planId" type="string">
    New plan ID
    </ResponseField>

    <ResponseField name="features" type="array">
    New feature list
    </ResponseField>
  </Expandable>
  </ResponseField>

  <ResponseField name="planId" type="string" required>
  Current plan ID (same as newState.planId)
  </ResponseField>

  <ResponseField name="creditsRemaining" type="number">
  User's remaining credit balance if applicable
  </ResponseField>
</Expandable>
</ResponseField>

### Example Payload

```json
{
  "id": "evt_entitlement_changed_001",
  "type": "entitlement.changed",
  "created": 1700000000,
  "data": {
    "oneSubUserId": "550e8400-e29b-41d4-a716-446655440000",
    "userEmail": "user@example.com",
    "previousState": {
      "planId": "basic",
      "features": ["feature_a", "feature_b"]
    },
    "newState": {
      "planId": "pro",
      "features": ["feature_a", "feature_b", "feature_c", "feature_d"]
    },
    "planId": "pro",
    "creditsRemaining": 2000
  }
}
```

### How to Handle

```typescript
case 'entitlement.changed':
  const { oneSubUserId, userEmail, previousState, newState, planId } = event.data;

  // Determine if this is an upgrade or downgrade
  const isUpgrade = compareplanIds(newState.planId, previousState.planId) > 0;

  // Update user's access level
  await updateUserPlan(oneSubUserId, newState.planId);

  // Update feature flags
  const addedFeatures = newState.features?.filter(f => !previousState.features?.includes(f));
  const removedFeatures = previousState.features?.filter(f => !newState.features?.includes(f));

  if (addedFeatures?.length) {
    await enableFeatures(oneSubUserId, addedFeatures);
  }

  if (removedFeatures?.length) {
    await disableFeatures(oneSubUserId, removedFeatures);
  }

  // Send notification email
  await sendPlanChangeEmail(userEmail, {
    previousPlan: previousState.planId,
    newPlan: newState.planId,
    isUpgrade
  });

  // Clear entitlement cache
  await clearUserCache(oneSubUserId);

  // Log change
  logger.info('Entitlement changed', {
    userId: oneSubUserId,
    email: userEmail,
    from: previousState.planId,
    to: newState.planId,
    type: isUpgrade ? 'upgrade' : 'downgrade'
  });

  break;
```

---

## verify.required

Sent when immediate verification of user entitlements is required due to a security or system event.

### When Sent

- Fraud detection triggers
- Admin manually flags account for review
- Suspicious activity detected
- System-level security events
- Policy violations
- Payment disputes

<Warning>
When you receive this event, you MUST verify the user's current entitlements via the `/api/v1/verify` endpoint before allowing further access.
</Warning>

### Payload

<ResponseField name="id" type="string" required>
Unique event ID
</ResponseField>

<ResponseField name="type" type="string" required>
Always `"verify.required"`
</ResponseField>

<ResponseField name="created" type="number" required>
Unix timestamp
</ResponseField>

<ResponseField name="data" type="object" required>
Event data

<Expandable title="Data Fields">
  <ResponseField name="oneSubUserId" type="string (UUID)" required>
  The 1Sub user ID
  </ResponseField>

  <ResponseField name="userEmail" type="string">
  The user's email address
  </ResponseField>

  <ResponseField name="reason" type="string" required>
  Reason verification is required: `"fraud_detected"`, `"admin_review"`, `"suspicious_activity"`, `"payment_dispute"`, `"policy_violation"`
  </ResponseField>
</Expandable>
</ResponseField>

### Example Payload

```json
{
  "id": "evt_verify_required_001",
  "type": "verify.required",
  "created": 1700000000,
  "data": {
    "oneSubUserId": "550e8400-e29b-41d4-a716-446655440000",
    "userEmail": "user@example.com",
    "reason": "suspicious_activity"
  }
}
```

### How to Handle

```typescript
case 'verify.required':
  const { oneSubUserId, userEmail, reason } = event.data;

  // CRITICAL: Immediately invalidate all cached entitlements
  await clearUserCache(oneSubUserId);

  // Flag user for fresh verification on next request
  await setVerificationRequired(oneSubUserId, true);

  // Optionally suspend access until verification
  if (reason === 'fraud_detected' || reason === 'policy_violation') {
    await suspendUserAccess(oneSubUserId);
  }

  // Log security event
  logger.warn('Verification required', {
    userId: oneSubUserId,
    email: userEmail,
    reason,
    severity: reason === 'fraud_detected' ? 'critical' : 'warning'
  });

  // Alert security team for critical reasons
  if (reason === 'fraud_detected') {
    await alertSecurityTeam({
      userId: oneSubUserId,
      email: userEmail,
      reason
    });
  }

  break;
```

### Important Notes

- This event forces a cache invalidation
- All subsequent requests for this user should call `/api/v1/verify`
- Do NOT rely on cached entitlement data after receiving this event
- Consider implementing automatic suspension for high-risk reasons

---

## credits.consumed

Sent when a user consumes credits for your tool.

### When Sent

- User makes API call that consumes credits
- Tool uses `/api/v1/credits/consume` endpoint
- Credits are successfully deducted from user's balance
- Sent after each successful credit consumption transaction

### Payload

<ResponseField name="id" type="string" required>
Unique event ID (UUID format) for deduplication
</ResponseField>

<ResponseField name="type" type="string" required>
Always `"credits.consumed"`
</ResponseField>

<ResponseField name="created" type="number" required>
Unix timestamp when the event was created
</ResponseField>

<ResponseField name="data" type="object" required>
Event data

<Expandable title="Data Fields">
  <ResponseField name="oneSubUserId" type="string (UUID)" required>
  The 1Sub user ID
  </ResponseField>

  <ResponseField name="amount" type="number" required>
  Number of credits consumed in this transaction
  </ResponseField>

  <ResponseField name="balanceRemaining" type="number" required>
  User's remaining credit balance after this transaction
  </ResponseField>

  <ResponseField name="transactionId" type="string (UUID)" required>
  Unique identifier for this credit transaction
  </ResponseField>
</Expandable>
</ResponseField>

### Example Payload

```json
{
  "id": "evt_abc123def456",
  "type": "credits.consumed",
  "created": 1700000000,
  "data": {
    "oneSubUserId": "550e8400-e29b-41d4-a716-446655440000",
    "amount": 10,
    "balanceRemaining": 90,
    "transactionId": "txn_abc123def456"
  }
}
```

### How to Handle

```typescript
case 'credits.consumed':
  const { oneSubUserId, amount, balanceRemaining, transactionId } = event.data;

  // Log credit consumption for analytics
  await logCreditUsage(oneSubUserId, {
    amount,
    balanceRemaining,
    transactionId,
    timestamp: new Date(event.created * 1000).toISOString()
  });

  // Check if user is approaching low balance
  if (balanceRemaining < 50) {
    await sendLowBalanceWarning(oneSubUserId, balanceRemaining);
  }

  // Update usage metrics
  await updateUsageMetrics(oneSubUserId, amount);

  // Track for billing/reporting
  await recordCreditConsumption({
    userId: oneSubUserId,
    creditsUsed: amount,
    remainingBalance: balanceRemaining,
    transactionId
  });

  break;
```

### Use Cases

- **Usage Analytics**: Track how users consume credits over time
- **Low Balance Warnings**: Proactively notify users before they run out
- **Billing & Reporting**: Generate usage reports for customers
- **Rate Limiting**: Implement custom rate limiting based on credit consumption
- **Fraud Detection**: Monitor unusual consumption patterns

---

## Event Deduplication

Always deduplicate events using the event `id` to handle retries:

```typescript
// In-memory deduplication (use Redis/DB in production)
const processedEvents = new Set<string>();

function handleWebhook(event: WebhookEvent) {
  // Check if already processed
  if (processedEvents.has(event.id)) {
    console.log(`Event ${event.id} already processed, skipping`);
    return;
  }
  
  // Mark as processed
  processedEvents.add(event.id);
  
  // Process event
  switch (event.type) {
    case 'subscription.activated':
      // ...
      break;
    case 'subscription.updated':
      // ...
      break;
    case 'subscription.canceled':
      // ...
      break;
    case 'purchase.completed':
      // ...
      break;
    case 'user.credit_low':
      // ...
      break;
    case 'user.credit_depleted':
      // ...
      break;
    case 'tool.status_changed':
      // ...
      break;
    case 'entitlement.granted':
      // ...
      break;
    case 'entitlement.revoked':
      // ...
      break;
    case 'entitlement.changed':
      // ...
      break;
    case 'verify.required':
      // ...
      break;
    case 'credits.consumed':
      // Note: This event uses 'event' field instead of 'type'
      // ...
      break;
    // ...
  }
}
```

## Event Ordering

Events may arrive out of order. Use the `created` timestamp to determine the correct sequence:

```typescript
// Store events
const events = [];
events.push(event);

// Sort by created timestamp before processing
events.sort((a, b) => a.created - b.created);

// Process in order
for (const event of events) {
  handleWebhook(event);
}
```

<Tip>
For critical operations, verify the current state via the API rather than relying solely on webhook order.
</Tip>

