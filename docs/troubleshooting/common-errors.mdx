---
title: "Common Errors"
description: "Solutions to common integration issues and error messages"
---

# Common Errors

Quick solutions to common issues when integrating with 1Sub.

## Authentication Errors

<AccordionGroup>
<Accordion title="Invalid API key">
**Error:**
```json
{
  "error": "Unauthorized",
  "message": "Invalid API key"
}
```

**Causes:**
- Wrong API key
- Missing `Bearer` prefix
- Extra spaces or characters
- API key revoked or regenerated

**Solution:**
1. Verify API key in your environment variables
2. Check you're using `Authorization: Bearer sk-tool-xxxxx`
3. Regenerate key from vendor dashboard if needed
4. Ensure no trailing spaces or newlines in `.env` file
</Accordion>

<Accordion title="Tool is inactive">
**Error:**
```json
{
  "error": "Forbidden",
  "message": "Tool is inactive"
}
```

**Causes:**
- Tool not published yet
- Tool suspended by 1Sub
- Tool deleted

**Solution:**
- Ensure tool is published in vendor dashboard
- Contact support if tool was suspended
- Check tool status in dashboard
</Accordion>
</AccordionGroup>

## JWT Verification Errors

<AccordionGroup>
<Accordion title="JWT verification failed">
**Error in logs:**
```
JWT verification failed: JWTExpired: token expired
```

**Causes:**
- Token older than 10 minutes
- User took too long to complete redirect
- Clock skew between servers

**Solution:**
- Redirect users faster (tokens expire in 10 minutes)
- Check server clock is synchronized
- Prompt user to try subscribing again
</Accordion>

<Accordion title="Invalid audience">
**Error:**
```
JWT verification failed: Invalid audience
```

**Causes:**
- Wrong tool ID in JWT verification
- Tool ID mismatch

**Solution:**
```typescript
// Make sure audience matches your tool ID
await jwtVerify(token, JWKS, {
  issuer: '1sub',
  audience: process.env.TOOL_ID, // Must match your actual tool ID
});
```
</Accordion>

<Accordion title="JWKS fetch failed">
**Error:**
```
Unable to fetch JWKS from https://1sub.io/.well-known/1sub-jwks.json
```

**Causes:**
- Network connectivity issues
- Firewall blocking HTTPS requests
- DNS resolution failure

**Solution:**
- Check network connectivity
- Verify firewall allows HTTPS to 1sub.io
- Try manually fetching: `curl https://1sub.io/.well-known/1sub-jwks.json`
- Implement retry logic with backoff
</Accordion>
</AccordionGroup>

## Subscription Verification Errors

<AccordionGroup>
<Accordion title="No subscription found (404)">
**Error:**
```json
{
  "error": "Not found",
  "message": "No subscription found for this tool"
}
```

**Causes:**
- User hasn't subscribed yet
- Wrong user ID
- Subscription to different tool
- User canceled subscription

**Solution:**
1. Verify `oneSubUserId` is correct
2. Check user actually subscribed
3. Redirect user to subscribe: `https://1sub.io/tools/YOUR_TOOL_ID`
4. Verify subscription in 1Sub dashboard
</Accordion>

<Accordion title="Email hash not matching">
**Error (when using emailSha256):**
```json
{
  "error": "Not found",
  "message": "No subscription found"
}
```

**Causes:**
- Email not lowercase before hashing
- Wrong hash algorithm
- Email has whitespace

**Solution:**
```typescript
import crypto from 'crypto';

function hashEmail(email: string): string {
  // Must normalize first!
  const normalized = email.toLowerCase().trim();
  return crypto.createHash('sha256').update(normalized).digest('hex');
}
```
</Accordion>
</AccordionGroup>

## Credit Consumption Errors

<AccordionGroup>
<Accordion title="Insufficient credits">
**Error:**
```json
{
  "error": "Insufficient credits",
  "message": "User does not have sufficient credits",
  "details": {
    "current_balance": 5,
    "required": 10,
    "shortfall": 5
  }
}
```

**Solution:**
Show user they need to buy more credits:

```typescript
try {
  await consumeCredits({ amount: 10, ... });
} catch (error) {
  if (error.response?.status === 400) {
    const { current_balance, required, shortfall } = error.response.data.details;
    
    showError(
      `You need ${shortfall} more credits. ` +
      `You have ${current_balance}, but ${required} are required.`,
      {
        action: {
          label: 'Buy Credits',
          url: 'https://1sub.io/buy-credits'
        }
      }
    );
  }
}
```
</Accordion>

<Accordion title="Idempotency key conflict">
**Error:**
```json
{
  "error": "Conflict",
  "message": "Idempotency key already used with different parameters"
}
```

**Causes:**
- Reusing idempotency key with different data
- Not generating unique keys

**Solution:**
Make idempotency keys truly unique per operation:

```typescript
// ✅ Good - unique per operation
const key = `${operationType}-${userId}-${operationId}-${timestamp}`;

// ❌ Bad - not unique enough
const key = userId; // Same for all operations!
```
</Accordion>
</AccordionGroup>

## Webhook Errors

<AccordionGroup>
<Accordion title="Invalid webhook signature">
**Error in logs:**
```
Webhook signature verification failed
```

**Causes:**
- Using parsed JSON instead of raw body
- Wrong webhook secret
- Not using timing-safe comparison
- Old timestamp (>5 minutes)

**Solution:**
1. Use raw body for verification:
```typescript
app.post('/webhooks/1sub',
  express.raw({ type: 'application/json' }), // MUST use raw
  (req, res) => {
    const payload = req.body.toString(); // Raw bytes
    // ...
  }
);
```

2. Verify webhook secret is correct
3. Use `crypto.timingSafeEqual()` for comparison
4. Check timestamp is recent
</Accordion>

<Accordion title="Webhooks not received">
**Problem:**
No webhooks arriving at your endpoint.

**Causes:**
- Webhook URL not configured
- URL not publicly accessible
- Server not running
- Firewall blocking requests

**Solution:**
1. Check webhook URL in vendor dashboard
2. Verify endpoint is publicly accessible: `curl https://your-endpoint.com/webhooks/1sub`
3. Use ngrok for local development
4. Check server logs for incoming requests
5. Verify HTTPS (HTTP webhooks are rejected)
</Accordion>

<Accordion title="Webhook timeout / retries">
**Problem:**
Webhooks timing out, receiving duplicates.

**Causes:**
- Processing takes >30 seconds
- Not acknowledging receipt quickly
- Blocking operations in webhook handler

**Solution:**
Acknowledge immediately, process async:

```typescript
app.post('/webhooks/1sub', async (req, res) => {
  // Verify signature
  if (!verifySignature(...)) {
    return res.status(401).send('Invalid signature');
  }
  
  // Acknowledge immediately (within 30 seconds)
  res.json({ received: true });
  
  // Process asynchronously
  const event = JSON.parse(req.body.toString());
  processWebhookAsync(event).catch(console.error);
});
```
</Accordion>
</AccordionGroup>

## Rate Limiting Errors

<AccordionGroup>
<Accordion title="Rate limit exceeded (429)">
**Error:**
```json
{
  "error": "Rate limit exceeded",
  "message": "Too many requests. Please try again later.",
  "details": {
    "retryAfter": 60
  }
}
```

**Causes:**
- Making too many API calls
- Not caching subscription status
- Retry loops without backoff

**Solution:**
1. Implement caching:
```typescript
const cache = new Map();

async function getSubscription(userId) {
  if (cache.has(userId)) {
    const cached = cache.get(userId);
    if (Date.now() - cached.timestamp < 60000) {
      return cached.data;
    }
  }
  
  const data = await verifySubscription(userId);
  cache.set(userId, { data, timestamp: Date.now() });
  return data;
}
```

2. Respect `Retry-After` header:
```typescript
if (error.response?.status === 429) {
  const retryAfter = error.response.headers['retry-after'];
  await sleep(retryAfter * 1000);
  return retry();
}
```

3. Use webhooks to invalidate cache instead of constant polling
</Accordion>
</AccordionGroup>

## Integration Issues

<AccordionGroup>
<Accordion title="User link not found">
**Problem:**
Can't find `oneSubUserId` for your local user.

**Causes:**
- User never completed redirect flow
- Link not stored in database
- User record deleted

**Solution:**
1. Check user_links table for mapping
2. Prompt user to re-link: generate new JWT redirect
3. Add error handling:
```typescript
const oneSubUserId = await getOneSubUserId(localUserId);

if (!oneSubUserId) {
  return res.status(403).json({
    error: 'not_linked',
    message: 'Please link your 1Sub account',
    linkUrl: 'https://1sub.io/tools/YOUR_TOOL_ID/subscribe'
  });
}
```
</Accordion>

<Accordion title="Subscription status out of sync">
**Problem:**
Your cached status doesn't match actual status.

**Causes:**
- Not processing webhooks
- Cache not invalidated
- Webhooks failed to deliver

**Solution:**
1. Ensure webhooks are working
2. Invalidate cache on webhook events
3. Add cache expiry:
```typescript
const CACHE_TTL = 5 * 60 * 1000; // 5 minutes

if (Date.now() - cached.timestamp > CACHE_TTL) {
  // Refetch
  cache.delete(userId);
  return fetchFresh(userId);
}
```
4. Verify subscription directly for critical operations
</Accordion>
</AccordionGroup>

## Getting Help

If you're still stuck after trying these solutions:

<CardGroup cols={2}>
<Card title="Email Support" icon="envelope">
  support@1sub.io
</Card>

<Card title="Join Discord" icon="discord">
  https://discord.gg/1sub
</Card>

<Card title="Check Status" icon="signal">
  https://status.1sub.io
</Card>

<Card title="View API Logs" icon="list">
  Check vendor dashboard for API request logs
</Card>
</CardGroup>

<Tip>
When contacting support, include:
- Error message and status code
- Request/response logs (redact API keys!)
- Steps to reproduce
- Your tool ID
</Tip>




